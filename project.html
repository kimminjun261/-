<!DOCTYPE html>
<html lang="ko">
<head>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>대청고 매점 재고 현황</title>
    <style>
            /* 기본 스타일 (데스크톱 및 모바일 공용) */
            body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 20px; background-color: #f4f7f6; color: #333; }
            .container { max-width: 900px; margin: 30px auto; background-color: #fff; padding: 30px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
            h1, h2 { text-align: center; color: #2c3e50; }
            #admin-toggle-btn { display: block; margin: 20px auto; padding: 10px 20px; font-size: 16px; cursor: pointer; background-color: #3498db; color: white; border: none; border-radius: 5px; transition: background-color 0.3s ease; }
            #admin-toggle-btn:hover { background-color: #2980b9; }
            #user-view, #admin-view { display: none; }
        
            /* 사용자 뷰 */
            #menu-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; margin-top: 20px; }
            .menu-item { background-color: #f9f9f9; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); transition: transform 0.2s ease; text-align: center; }
            .menu-item:hover { transform: translateY(-5px); }
            .menu-item img { width: 100%; height: 150px; object-fit: cover; border-radius: 5px; margin-bottom: 10px; }
            .menu-item h3 { margin-top: 0; color: #34495e; }
            .menu-item p { margin: 5px 0; font-size: 14px; }
            .menu-item .status { font-weight: bold; }
            .menu-item .status.in-stock { color: #27ae60; }
            .menu-item .status.sold-out { color: #e74c3c; }
            
            /* 관리자 뷰 */
            #admin-login, #admin-dashboard { padding: 20px; border: 1px solid #eee; border-radius: 8px; margin-top: 20px; background-color: #ecf0f1; }
            #admin-login input[type="password"], #admin-login button { padding: 10px; margin-right: 10px; border: 1px solid #ccc; border-radius: 5px; }
            #admin-login button { background-color: #2ecc71; color: white; cursor: pointer; border: none; transition: background-color 0.3s ease; }
            #admin-login button:hover { background-color: #27ae60; }
        
            .admin-menu-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #ddd; }
            .admin-menu-item:last-child { border-bottom: none; }
            .admin-menu-item input[type="number"], .admin-menu-item input[type="text"] { width: 60px; padding: 5px; border: 1px solid #ccc; border-radius: 3px; }
            .admin-menu-item button { padding: 5px 10px; margin-left: 5px; border-radius: 3px; cursor: pointer; transition: background-color 0.3s ease; }
            .admin-menu-item .update-btn { background-color: #3498db; color: white; border: none; }
            .admin-menu-item .update-btn:hover { background-color: #2980b9; }
            .admin-menu-item .delete-btn { background-color: #e74c3c; color: white; border: none; }
            .admin-menu-item .delete-btn:hover { background-color: #c0392b; }
        
            #add-menu-form input, #add-menu-form button { padding: 8px; margin-right: 8px; border: 1px solid #ccc; border-radius: 4px; }
            #add-menu-form button { background-color: #9b59b6; color: white; border: none; cursor: pointer; }
            #add-menu-form button:hover { background-color: #8e44ad; }
            #image-preview { display: block; max-width: 100px; max-height: 100px; margin-top: 10px; border: 1px solid #ccc; padding: 5px; border-radius: 5px; }
        
            .logout-btn { background-color: #f39c12; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; margin-top: 20px; display: block; float: right; }
            .logout-btn:hover { background-color: #e67e22; }
        
            /* 모바일 전용 스타일 (최대 600px 너비) */
            @media (max-width: 600px) {
                body { padding: 10px; }
                .container { padding: 20px; margin: 10px auto; }
                
                #add-menu-form input, #add-menu-form button {
                    display: block;
                    width: 100%;
                    margin-right: 0;
                    margin-bottom: 10px;
                    box-sizing: border-box; /* 패딩이 너비에 포함되도록 설정 */
                }
                
                .admin-menu-item {
                    flex-direction: column;
                    align-items: flex-start;
                }
        
                .admin-menu-item > div {
                    margin-top: 10px;
                }
        
                .admin-menu-item input[type="number"] {
                    width: 80px;
                    margin-bottom: 5px;
                }
        
                .admin-menu-item button {
                    width: 80px;
                }
                
                .logout-btn {
                    float: none;
                    width: 100%;
                    text-align: center;
                }
            }
        </style>
</head>
<body>
    <div class="container">
        <h1>🏫 대청고 매점 재고 현황 🏫</h1>
        
        <button id="admin-toggle-btn">관리자 모드</button>

        <div id="user-view">
            <h2>현재 판매 중인 상품</h2>
            <div id="menu-list">
                </div>
        </div>

        <div id="admin-view">
            <h2>관리자 로그인</h2>
            <div id="admin-login">
                <input type="password" id="admin-password" placeholder="비밀번호를 입력하세요">
                <button onclick="loginAdmin()">로그인</button>
            </div>

            <div id="admin-dashboard" style="display: none;">
                <h2>상품 관리</h2>
                <button class="logout-btn" onclick="logoutAdmin()">로그아웃</button>
                <div id="admin-menu-list">
                    </div>

                <h3>새 상품 추가</h3>
                <div id="add-menu-form">
                    <input type="text" id="new-menu-name" placeholder="상품 이름">
                    <input type="number" id="new-menu-price" placeholder="가격" min="0">
                    <input type="number" id="new-menu-stock" placeholder="초기 재고" min="0">
                    <input type="file" id="new-menu-image-file" accept="image/*">
                    <img id="image-preview" src="#" alt="Image Preview" style="display: none;">
                    <button onclick="addMenuItem()">추가</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const ADMIN_PASSWORD = "admin";
        let isAdminLoggedIn = false;

        let menuItems = [
            { id: 1, name: "불닭볶음면", price: 1500, stock: 10, image: "https://via.placeholder.com/150/FF5733" },
            { id: 2, name: "삼각김밥(참치마요)", price: 500, stock: 5, image: "https://via.placeholder.com/150/33C1FF" },
            { id: 3, name: "포카칩", price: 1200, stock: 20, image: "https://via.placeholder.com/150/33FF57" },
            { id: 4, name: "환타 오렌지", price: 800, stock: 15, image: "https://via.placeholder.com/150/FFC300" },
            { id: 5, name: "초코우유", price: 1000, stock: 0, image: "https://via.placeholder.com/150/8D33FF" }
        ];

        document.addEventListener('DOMContentLoaded', () => {
            loadMenuItems();
            renderUserView();
            checkAdminStatus();
        });

        function loadMenuItems() {
            const storedMenuItems = localStorage.getItem('menuItems');
            if (storedMenuItems) {
                menuItems = JSON.parse(storedMenuItems);
            } else {
                localStorage.setItem('menuItems', JSON.stringify(menuItems));
            }
        }

        function saveMenuItems() {
            localStorage.setItem('menuItems', JSON.stringify(menuItems));
        }

        function renderUserView() {
            const menuListDiv = document.getElementById('menu-list');
            menuListDiv.innerHTML = '';

            if (menuItems.length === 0) {
                menuListDiv.innerHTML = '<p style="text-align: center;">현재 판매 중인 상품이 없습니다.</p>';
                return;
            }

            menuItems.forEach(item => {
                const statusClass = item.stock > 0 ? 'in-stock' : 'sold-out';
                const statusText = item.stock > 0 ? `재고: ${item.stock}개` : '품절';
                
                const menuItemDiv = document.createElement('div');
                menuItemDiv.classList.add('menu-item');
                menuItemDiv.innerHTML = `
                    <img src="${item.image}" alt="${item.name}">
                    <h3>${item.name}</h3>
                    <p>가격: ${item.price.toLocaleString()}원</p>
                    <p class="status ${statusClass}">${statusText}</p>
                `;
                menuListDiv.appendChild(menuItemDiv);
            });
        }

        function renderAdminView() {
            const adminMenuListDiv = document.getElementById('admin-menu-list');
            adminMenuListDiv.innerHTML = '';

            if (menuItems.length === 0) {
                adminMenuListDiv.innerHTML = '<p style="text-align: center;">등록된 상품이 없습니다.</p>';
                return;
            }

            menuItems.forEach(item => {
                const adminMenuItemDiv = document.createElement('div');
                adminMenuItemDiv.classList.add('admin-menu-item');
                adminMenuItemDiv.innerHTML = `
                    <span>${item.name} (${item.price.toLocaleString()}원)</span>
                    <div>
                        <input type="number" id="stock-${item.id}" value="${item.stock}" min="0">
                        <button class="update-btn" onclick="updateStock(${item.id})">수정</button>
                        <button class="delete-btn" onclick="deleteMenuItem(${item.id})">삭제</button>
                    </div>
                `;
                adminMenuListDiv.appendChild(adminMenuItemDiv);
            });
        }

        document.getElementById('admin-toggle-btn').addEventListener('click', () => {
            if (isAdminLoggedIn) {
                document.getElementById('user-view').style.display = 'block';
                document.getElementById('admin-view').style.display = 'none';
                document.getElementById('admin-toggle-btn').textContent = '관리자 모드';
                isAdminLoggedIn = false;
            } else {
                document.getElementById('user-view').style.display = 'none';
                document.getElementById('admin-view').style.display = 'block';
                document.getElementById('admin-login').style.display = 'block';
                document.getElementById('admin-dashboard').style.display = 'none';
                document.getElementById('admin-toggle-btn').textContent = '사용자 모드';
            }
            renderUserView();
        });

        function loginAdmin() {
            const passwordInput = document.getElementById('admin-password').value;
            if (passwordInput === ADMIN_PASSWORD) {
                isAdminLoggedIn = true;
                localStorage.setItem('isAdminLoggedIn', 'true');
                document.getElementById('admin-login').style.display = 'none';
                document.getElementById('admin-dashboard').style.display = 'block';
                renderAdminView();
                alert('관리자 모드에 로그인되었습니다.');
            } else {
                alert('비밀번호가 틀렸습니다.');
            }
            document.getElementById('admin-password').value = '';
        }

        function logoutAdmin() {
            isAdminLoggedIn = false;
            localStorage.removeItem('isAdminLoggedIn');
            document.getElementById('admin-dashboard').style.display = 'none';
            document.getElementById('admin-login').style.display = 'block';
            alert('관리자 모드에서 로그아웃되었습니다.');
            
            document.getElementById('user-view').style.display = 'block';
            document.getElementById('admin-view').style.display = 'none';
            document.getElementById('admin-toggle-btn').textContent = '관리자 모드';
            renderUserView();
        }

        function checkAdminStatus() {
            if (localStorage.getItem('isAdminLoggedIn') === 'true') {
                isAdminLoggedIn = true;
                document.getElementById('user-view').style.display = 'none';
                document.getElementById('admin-view').style.display = 'block';
                document.getElementById('admin-login').style.display = 'none';
                document.getElementById('admin-dashboard').style.display = 'block';
                document.getElementById('admin-toggle-btn').textContent = '사용자 모드';
                renderAdminView();
            } else {
                document.getElementById('user-view').style.display = 'block';
                document.getElementById('admin-view').style.display = 'none';
                document.getElementById('admin-toggle-btn').textContent = '관리자 모드';
            }
        }

        function updateStock(id) {
            const stockInput = document.getElementById(`stock-${id}`);
            const newStock = parseInt(stockInput.value);

            if (isNaN(newStock) || newStock < 0) {
                alert('유효한 재고 수량을 입력해주세요.');
                return;
            }

            const itemIndex = menuItems.findIndex(item => item.id === id);
            if (itemIndex !== -1) {
                menuItems[itemIndex].stock = newStock;
                saveMenuItems();
                renderAdminView();
                renderUserView();
                alert(`${menuItems[itemIndex].name}의 재고가 ${newStock}개로 업데이트되었습니다.`);
            }
        }

        function deleteMenuItem(id) {
            if (confirm('정말로 이 상품을 삭제하시겠습니까?')) {
                menuItems = menuItems.filter(item => item.id !== id);
                saveMenuItems();
                renderAdminView();
                renderUserView();
                alert('상품이 삭제되었습니다.');
            }
        }

        // 새 메뉴 아이템 추가
        function addMenuItem() {
            const nameInput = document.getElementById('new-menu-name');
            const priceInput = document.getElementById('new-menu-price');
            const stockInput = document.getElementById('new-menu-stock');
            const imageFile = document.getElementById('new-menu-image-file').files[0];

            const name = nameInput.value.trim();
            const price = parseInt(priceInput.value);
            const stock = parseInt(stockInput.value);
            
            if (!name || isNaN(price) || price < 0 || isNaN(stock) || stock < 0) {
                alert('상품 이름, 가격, 초기 재고를 올바르게 입력해주세요.');
                return;
            }

            const newId = menuItems.length > 0 ? Math.max(...menuItems.map(item => item.id)) + 1 : 1;
            
            if (imageFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const newItem = { id: newId, name, price, stock, image: e.target.result };
                    menuItems.push(newItem);
                    saveMenuItems();
                    renderAdminView();
                    renderUserView();
                    alert(`${name} 상품이 추가되었습니다.`);
                };
                reader.readAsDataURL(imageFile);
            } else {
                const newItem = { id: newId, name, price, stock, image: '' };
                menuItems.push(newItem);
                saveMenuItems();
                renderAdminView();
                renderUserView();
                alert(`${name} 상품이 추가되었습니다. (이미지 없음)`);
            }

            // 입력 필드 초기화
            nameInput.value = '';
            priceInput.value = '';
            stockInput.value = '';
            document.getElementById('new-menu-image-file').value = '';
        }

        // 이미지 미리보기 기능
        document.getElementById('new-menu-image-file').addEventListener('change', function(event) {
            const file = event.target.files[0];
            const preview = document.getElementById('image-preview');
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                };
                reader.readAsDataURL(file);
            } else {
                preview.style.display = 'none';
            }
            
        });
        // 5초마다 사용자 뷰 자동 업데이트
        setInterval(() => {
    // 사용자가 관리자 모드에 있지 않을 때만 업데이트
            if (!isAdminLoggedIn) {
            loadMenuItems();
            renderUserView();
        }
    }, 5000); // 5000ms = 5초
            

    </script>
</body>
</html>